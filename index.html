<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mi Bombo Clicker</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&family=Lilita+One&display=swap" rel="stylesheet">
<style>
:root {
  --green: #58cc02;
  --green-dark: #46a302;
  --green-glow: rgba(88,204,2,0.4);
  --yellow: #ffc800;
  --yellow-dark: #e6b200;
  --red: #ff4b4b;
  --blue: #1cb0f6;
  --bg: #131f24;
  --panel: #1e3340;
  --panel2: #243d4d;
  --panel3: #2a4558;
  --border: #2e5068;
  --text: #ffffff;
  --muted: #7a9fb5;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; overflow: hidden; }
body {
  font-family: 'Baloo 2', cursive;
  background: var(--bg);
  color: var(--text);
  display: flex; flex-direction: column; overflow: hidden;
}
#header {
  background: var(--panel);
  border-bottom: 3px solid var(--border);
  padding: 0 20px; height: 56px;
  display: flex; align-items: center; justify-content: space-between;
  flex-shrink: 0; position: relative; z-index: 10;
}
#header h1 {
  font-family: 'Lilita One', cursive; font-size: 24px;
  color: var(--yellow);
  text-shadow: 0 2px 0 var(--yellow-dark), 0 0 20px rgba(255,200,0,0.4);
}
#header .streak {
  display: flex; align-items: center; gap: 8px;
  background: var(--panel2); border: 2px solid var(--border);
  border-radius: 20px; padding: 4px 14px;
  font-weight: 700; font-size: 14px; color: var(--yellow);
}
#game {
  display: grid;
  grid-template-columns: 260px 1fr 290px;
  flex: 1; overflow: hidden;
}
.side-panel {
  background: var(--panel);
  border-right: 3px solid var(--border);
  overflow-y: auto; overflow-x: hidden;
  scrollbar-width: thin; scrollbar-color: var(--border) transparent;
}
#building-panel { border-right: none; border-left: 3px solid var(--border); }
.side-panel::-webkit-scrollbar { width: 4px; }
.side-panel::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
.panel-header {
  padding: 12px 16px 8px;
  font-family: 'Lilita One', cursive; font-size: 13px;
  letter-spacing: 2px; color: var(--muted); text-transform: uppercase;
  border-bottom: 2px solid var(--border);
  position: sticky; top: 0; background: var(--panel); z-index: 2;
}

/* UPGRADES */
.upgrade-item {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 14px; border-bottom: 1px solid var(--border);
  cursor: pointer; transition: background 0.15s; position: relative;
}
.upgrade-item:hover:not(.upg-locked):not(.upg-bought) { background: var(--panel2); }
.upgrade-item.upg-locked { opacity: 0.3; cursor: default; pointer-events: none; }
.upgrade-item.upg-bought { opacity: 0.5; pointer-events: none; }
.upgrade-item.upg-affordable .upg-icon-wrap { box-shadow: 0 0 12px var(--green-glow); border-color: var(--green) !important; }
.upg-icon-wrap {
  width: 46px; height: 46px; min-width: 46px;
  border-radius: 12px; border: 2px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  font-size: 26px; background: var(--panel2); flex-shrink: 0;
  transition: box-shadow 0.2s, border-color 0.2s;
}
.upg-text { flex: 1; min-width: 0; }
.upg-name { font-weight: 800; font-size: 13px; line-height: 1.2; }
.upg-desc { font-size: 11px; color: var(--muted); line-height: 1.3; margin-top: 2px; }
.upg-cost { font-size: 11px; color: var(--yellow); font-weight: 700; margin-top: 2px; }
.bought-badge {
  position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
  background: var(--green); color: white; font-size: 11px; font-weight: 800;
  padding: 2px 7px; border-radius: 20px;
}

/* CENTER */
#center {
  display: flex; flex-direction: column; align-items: center;
  justify-content: flex-start; overflow: hidden;
  padding: 16px 20px 12px; gap: 12px; position: relative;
  background: radial-gradient(ellipse at center top, #1a3545 0%, var(--bg) 70%);
}
#score-num {
  font-family: 'Lilita One', cursive; font-size: 52px; line-height: 1;
  color: var(--yellow);
  text-shadow: 0 3px 0 var(--yellow-dark), 0 0 40px rgba(255,200,0,0.3);
}
#score-num.pop { animation: scorePop 0.12s ease; }
@keyframes scorePop { 0%,100%{transform:scale(1)} 50%{transform:scale(1.06)} }
#score-label { font-size: 12px; color: var(--muted); font-weight: 700; letter-spacing: 3px; text-transform: uppercase; }
#cps-display { font-size: 15px; color: var(--green); font-weight: 800; margin-top: 4px; }
#score-area { text-align: center; }

#click-area {
  position: relative; width: 220px; height: 220px;
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.ring {
  position: absolute; border-radius: 50%; border: 2px solid;
  animation: ring-pulse 2s ease-in-out infinite;
}
.ring-1 { width: 218px; height: 218px; border-color: rgba(88,204,2,0.15); }
.ring-2 { width: 185px; height: 185px; border-color: rgba(255,200,0,0.12); animation-delay: 0.6s; }
.ring-3 { width: 152px; height: 152px; border-color: rgba(28,176,246,0.1); animation-delay: 1.2s; }
@keyframes ring-pulse {
  0%,100% { transform: scale(1); opacity: 0.6; }
  50% { transform: scale(1.05); opacity: 1; }
}
.click-glow {
  position: absolute; width: 160px; height: 160px; border-radius: 50%;
  background: radial-gradient(circle, rgba(88,204,2,0.15) 0%, transparent 70%);
  animation: glow-breathe 2.5s ease-in-out infinite;
}
@keyframes glow-breathe {
  0%,100% { transform: scale(1); opacity: 0.8; }
  50% { transform: scale(1.15); opacity: 1; }
}
#bombo-btn {
  position: relative; z-index: 2;
  width: 148px; height: 148px; border-radius: 50%;
  border: 5px solid var(--green-dark);
  background: radial-gradient(circle at 38% 32%, #e8f5e9, #a8d5a2 40%, #5cb85c 70%, #2e7d32);
  cursor: pointer; transition: transform 0.08s, box-shadow 0.08s;
  box-shadow: 0 8px 0 var(--green-dark), 0 10px 30px rgba(88,204,2,0.5),
    inset 0 -4px 8px rgba(0,0,0,0.2), inset 0 4px 10px rgba(255,255,255,0.3);
  overflow: hidden; display: flex; align-items: center; justify-content: center; padding: 0;
}
#bombo-btn:hover {
  box-shadow: 0 8px 0 var(--green-dark), 0 14px 40px rgba(88,204,2,0.7),
    inset 0 -4px 8px rgba(0,0,0,0.2), inset 0 4px 10px rgba(255,255,255,0.3);
}
#bombo-btn.clicked {
  transform: translateY(6px) scale(0.94);
  box-shadow: 0 2px 0 var(--green-dark), 0 4px 16px rgba(88,204,2,0.4),
    inset 0 2px 6px rgba(0,0,0,0.3);
}
#bombo-btn img {
  width: 120px; height: 120px; object-fit: contain;
  pointer-events: none; transition: transform 0.08s;
  filter: drop-shadow(0 3px 6px rgba(0,0,0,0.4));
}
#bombo-btn.clicked img { transform: scale(0.93) rotate(-3deg); }

#xp-bar-wrap {
  width: 100%; max-width: 340px; background: var(--panel2);
  border-radius: 20px; border: 2px solid var(--border); padding: 4px;
}
#xp-bar {
  height: 12px; border-radius: 16px;
  background: linear-gradient(90deg, var(--green), #a8ff00);
  transition: width 0.4s ease; box-shadow: 0 0 8px var(--green-glow); width: 0%;
}
#xp-label { text-align: center; font-size: 11px; color: var(--muted); font-weight: 700; margin-top: 3px; letter-spacing: 1px; }

#stats-row { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
.stat-pill {
  background: var(--panel2); border: 2px solid var(--border);
  border-radius: 20px; padding: 5px 14px;
  font-size: 12px; font-weight: 800;
  display: flex; align-items: center; gap: 5px; color: var(--muted);
}
.stat-pill span { color: var(--text); font-size: 13px; }

#milestone-row { display: flex; gap: 6px; flex-wrap: wrap; justify-content: center; max-width: 380px; }
.ms-badge {
  background: var(--panel2); border: 2px solid var(--border);
  border-radius: 20px; padding: 3px 10px;
  font-size: 11px; font-weight: 800; color: var(--muted); transition: all 0.4s;
}
.ms-badge.done {
  border-color: var(--yellow); color: var(--yellow);
  background: rgba(255,200,0,0.1); box-shadow: 0 0 10px rgba(255,200,0,0.25);
}

#prestige-btn {
  background: linear-gradient(135deg, #9333ea, #e11d7a);
  border: none; border-bottom: 4px solid #7c3aed;
  border-radius: 14px; padding: 10px 28px;
  color: white; font-family: 'Lilita One', cursive;
  font-size: 17px; letter-spacing: 1px; cursor: pointer;
  box-shadow: 0 0 24px rgba(147,51,234,0.5);
  transition: all 0.15s; display: none;
}
#prestige-btn:hover { transform: scale(1.04); box-shadow: 0 0 36px rgba(147,51,234,0.7); }
#prestige-btn:active { transform: translateY(3px); border-bottom-width: 1px; }

/* BUILDINGS */
.building-item {
  display: flex; align-items: center;
  border-bottom: 2px solid var(--border);
  cursor: pointer; transition: background 0.15s;
  position: relative; overflow: hidden;
}
.building-item:hover:not(.bld-locked) { background: var(--panel2); }
.building-item.bld-locked { opacity: 0.25; cursor: not-allowed; pointer-events: none; }
.building-item.bld-affordable {
  background: rgba(88,204,2,0.05);
}
.building-item.bld-affordable::before {
  content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
  background: var(--green);
}
.bld-icon {
  width: 54px; height: 54px; min-width: 54px;
  display: flex; align-items: center; justify-content: center;
  font-size: 28px; background: var(--panel2);
  border-right: 2px solid var(--border); flex-shrink: 0; position: relative; overflow: hidden;
}
.bld-icon.shimmer::after {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.1) 50%, transparent 100%);
  animation: shimmer 1.5s infinite;
}
@keyframes shimmer { 0%{transform:translateX(-100%)} 100%{transform:translateX(100%)} }
.bld-body { flex: 1; padding: 8px 10px; min-width: 0; }
.bld-name { font-weight: 800; font-size: 13px; }
.bld-stats { font-size: 11px; color: var(--muted); margin-top: 2px; }
.bld-cost { color: var(--yellow); font-weight: 700; }
.bld-count {
  width: 50px; min-width: 50px; text-align: center;
  font-family: 'Lilita One', cursive; font-size: 26px;
  color: var(--text); padding-right: 10px; flex-shrink: 0;
}
.bld-count.has-items { color: var(--green); }

.float-txt {
  position: fixed; font-family: 'Lilita One', cursive; font-size: 22px;
  pointer-events: none; z-index: 9999;
  animation: flyUp 1.1s ease-out forwards;
  text-shadow: 0 2px 6px rgba(0,0,0,0.6);
}
@keyframes flyUp {
  0% { opacity: 1; transform: translateY(0) scale(1); }
  30% { opacity: 1; transform: translateY(-30px) scale(1.1); }
  100% { opacity: 0; transform: translateY(-90px) scale(0.7); }
}

.golden {
  position: fixed; font-size: 50px; cursor: pointer; z-index: 800;
  filter: drop-shadow(0 0 16px gold) drop-shadow(0 0 30px orange);
  animation: goldFloat 0.8s ease-in-out infinite alternate, goldAppear 8s forwards;
  user-select: none;
}
.golden:hover { transform: scale(1.3) rotate(10deg) !important; }
@keyframes goldFloat { from{transform:translateY(0) rotate(-5deg)} to{transform:translateY(-12px) rotate(5deg)} }
@keyframes goldAppear {
  0%{opacity:0;transform:scale(0)} 5%{opacity:1;transform:scale(1.2)} 10%{transform:scale(1)}
  85%{opacity:1} 100%{opacity:0;pointer-events:none}
}

#notif {
  position: fixed; bottom: 20px; left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: var(--panel2); border: 2px solid var(--green);
  border-bottom: 4px solid var(--green-dark);
  border-radius: 16px; padding: 12px 24px;
  font-size: 15px; font-weight: 800; color: white;
  box-shadow: 0 8px 30px rgba(0,0,0,0.5), 0 0 20px var(--green-glow);
  transition: transform 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
  z-index: 9999; text-align: center; pointer-events: none; max-width: 340px;
}
#notif.show { transform: translateX(-50%) translateY(0); }

#fx-canvas { position: fixed; inset: 0; pointer-events: none; z-index: 200; }
</style>
</head>
<body>
<canvas id="fx-canvas"></canvas>
<div id="notif"></div>

<div id="header">
  <h1>ü•Å MI BOMBO CLICKER</h1>
  <div class="streak">üî• <span id="header-total">0</span> TOTAL BOMBOS</div>
</div>

<div id="game">
  <div class="side-panel" id="upgrade-panel">
    <div class="panel-header">‚ö° Upgrades</div>
  </div>

  <div id="center">
    <div id="score-area">
      <div id="score-num">0</div>
      <div id="score-label">BOMBOS</div>
      <div id="cps-display">0 per second</div>
    </div>

    <div id="click-area">
      <div class="ring ring-1"></div>
      <div class="ring ring-2"></div>
      <div class="ring ring-3"></div>
      <div class="click-glow"></div>
      <button id="bombo-btn">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSOkcxljKS9eYc1PPQXz4TXbzpq7dyLEH5MHg&s" alt="Mi Bombo">
      </button>
    </div>

    <div id="xp-bar-wrap">
      <div id="xp-bar"></div>
      <div id="xp-label">Next milestone: 10</div>
    </div>

    <div id="stats-row">
      <div class="stat-pill">üëÜ Per click: <span id="stat-click">1</span></div>
      <div class="stat-pill">‚ö° Per sec: <span id="stat-cps">0</span></div>
      <div class="stat-pill">‚ú® Prestige: <span id="stat-prestige" style="color:#e11d7a">0</span></div>
    </div>

    <div id="milestone-row"></div>
    <button id="prestige-btn" onclick="doPrestige()">‚ú® PRESTIGE ‚ú®</button>
  </div>

  <div class="side-panel" id="building-panel">
    <div class="panel-header">üèóÔ∏è Production</div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const BUILDINGS = [
  { id:'shaker',     name:'ü™á Shaker',           baseCost:10,       baseCps:0.1  },
  { id:'tambourine', name:'ü™ò Tambourine',        baseCost:100,      baseCps:0.5  },
  { id:'drummer',    name:'ü•Å Street Drummer',    baseCost:500,      baseCps:2    },
  { id:'band',       name:'üé∑ Brass Band',        baseCost:2500,     baseCps:8    },
  { id:'studio',     name:'üéôÔ∏è Recording Studio', baseCost:12000,    baseCps:30   },
  { id:'festival',   name:'üé™ Bombo Festival',    baseCost:60000,    baseCps:100  },
  { id:'radio',      name:'üìª Radio Empire',      baseCost:300000,   baseCps:400  },
  { id:'factory',    name:'üè≠ Beat Factory',      baseCost:1500000,  baseCps:1500 },
  { id:'dimension',  name:'üåÄ Rhythm Dimension',  baseCost:10000000, baseCps:6000 },
];

// Each upgrade's apply() mutates the passed state object directly
const UPGRADES = [
  { id:'sticks',       icon:'ü•¢', name:'Better Drumsticks',    desc:'Click power √ó2',                   cost:100,     requires:0,
    apply(s){ s.clickMult *= 2; } },
  { id:'gloves',       icon:'üß§', name:'Power Gloves',         desc:'Click power √ó3',                   cost:800,     requires:50,
    apply(s){ s.clickMult *= 3; } },
  { id:'caffeine',     icon:'‚òï', name:'Caf√© con Leche',       desc:'Click power √ó5',                   cost:5000,    requires:200,
    apply(s){ s.clickMult *= 5; } },
  { id:'robot_arms',   icon:'ü¶æ', name:'Robot Arms',           desc:'Click power √ó10',                  cost:50000,   requires:1000,
    apply(s){ s.clickMult *= 10; } },
  { id:'golden_touch', icon:'‚ú®', name:'Golden Touch',         desc:'Clicks gain +2% of CPS',           cost:25000,   requires:500,
    apply(s){ s.goldenTouch = true; } },
  { id:'autotap1',     icon:'ü§ñ', name:'Auto-Tapper Mk1',      desc:'+2 auto clicks/sec',               cost:400,     requires:0,
    apply(s){ s.autoClicks += 2; } },
  { id:'autotap2',     icon:'ü¶ø', name:'Auto-Tapper Mk2',      desc:'+8 auto clicks/sec',               cost:8000,    requires:100,
    apply(s){ s.autoClicks += 8; } },
  { id:'shaker2',      icon:'ü™á', name:'Premium Shaker',       desc:'Shakers produce 2√ó more',          cost:200,     requires:0,
    apply(s){ s.bldMult['shaker'] *= 2; } },
  { id:'tamb2',        icon:'ü™ò', name:'Tuned Tambourine',     desc:'Tambourines produce 2√ó more',      cost:1500,    requires:0,
    apply(s){ s.bldMult['tambourine'] *= 2; } },
  { id:'drum2',        icon:'ü•Å', name:'Pro Drumheads',        desc:'Street Drummers produce 2√ó more',  cost:8000,    requires:0,
    apply(s){ s.bldMult['drummer'] *= 2; } },
  { id:'band2',        icon:'üé∑', name:'Sheet Music',          desc:'Brass Bands produce 2√ó more',      cost:40000,   requires:0,
    apply(s){ s.bldMult['band'] *= 2; } },
  { id:'studio2',      icon:'üéôÔ∏è', name:'Gold Microphone',    desc:'Studios produce 2√ó more',          cost:150000,  requires:0,
    apply(s){ s.bldMult['studio'] *= 2; } },
  { id:'festival2',    icon:'üé™', name:'Main Stage',           desc:'Festivals produce 2√ó more',        cost:800000,  requires:0,
    apply(s){ s.bldMult['festival'] *= 2; } },
  { id:'megabass',     icon:'üîä', name:'Mega Bass Boost',      desc:'All buildings produce 1.5√ó more',  cost:500000,  requires:5000,
    apply(s){ for(const k in s.bldMult) s.bldMult[k] *= 1.5; } },
  { id:'duolingo',     icon:'ü¶â', name:'Duolingo Power',       desc:'ALL production √ó2 ‚Äî you missed a lesson!', cost:5000000, requires:50000,
    apply(s){ for(const k in s.bldMult) s.bldMult[k] *= 2; s.clickMult *= 2; } },
];

const MILESTONES = [
  {id:'m10',   label:'10',   target:10},
  {id:'m100',  label:'100',  target:100},
  {id:'m1k',   label:'1K',   target:1000},
  {id:'m10k',  label:'10K',  target:10000},
  {id:'m100k', label:'100K', target:100000},
  {id:'m1m',   label:'1M',   target:1e6},
  {id:'m10m',  label:'10M',  target:1e7},
  {id:'m100m', label:'100M', target:1e8},
];

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const state = {
  score: 0,
  totalEarned: 0,
  clickMult: 1,
  autoClicks: 0,
  goldenTouch: false,
  cps: 0,
  prestige: 0,
  prestigeMult: 1,
  buildings: {},
  bldMult: {},
  bought: {},
  milestones: {},
};
BUILDINGS.forEach(b => { state.buildings[b.id] = 0; state.bldMult[b.id] = 1; });

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fmt(n) {
  n = Math.floor(n);
  if (n >= 1e15) return (n/1e15).toFixed(2)+'Qa';
  if (n >= 1e12) return (n/1e12).toFixed(2)+'T';
  if (n >= 1e9)  return (n/1e9).toFixed(2)+'B';
  if (n >= 1e6)  return (n/1e6).toFixed(2)+'M';
  if (n >= 1e3)  return (n/1e3).toFixed(1)+'K';
  return n.toLocaleString();
}
function getBldCost(b) { return Math.floor(b.baseCost * Math.pow(1.15, state.buildings[b.id])); }
function recalcCps() {
  let c = 0;
  BUILDINGS.forEach(b => { c += b.baseCps * state.buildings[b.id] * state.bldMult[b.id]; });
  state.cps = c * state.prestigeMult;
}
function getClickPower() {
  let p = Math.max(1, state.clickMult) * state.prestigeMult;
  if (state.goldenTouch) p += state.cps * 0.02;
  return Math.max(1, p);
}
function addScore(n) { state.score += n; state.totalEarned += n; }

// ‚îÄ‚îÄ RENDER UPGRADES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderUpgrades() {
  const panel = document.getElementById('upgrade-panel');
  panel.querySelectorAll('.upgrade-item').forEach(e => e.remove());
  UPGRADES.forEach(u => {
    const bought    = !!state.bought[u.id];
    const unlocked  = state.totalEarned >= u.requires;
    const affordable = state.score >= u.cost && unlocked;
    const div = document.createElement('div');
    div.className = 'upgrade-item'
      + (bought       ? ' upg-bought'    : '')
      + (!bought && !unlocked ? ' upg-locked' : '')
      + (!bought && affordable ? ' upg-affordable' : '');
    div.innerHTML = `
      <div class="upg-icon-wrap">${u.icon}</div>
      <div class="upg-text">
        <div class="upg-name">${u.name}</div>
        <div class="upg-desc">${u.desc}</div>
        ${!bought ? `<div class="upg-cost">ü•Å ${fmt(u.cost)}</div>` : ''}
      </div>
      ${bought ? '<div class="bought-badge">‚úì</div>' : ''}
    `;
    if (!bought && unlocked) div.addEventListener('click', () => buyUpgrade(u.id));
    panel.appendChild(div);
  });
}

// ‚îÄ‚îÄ RENDER BUILDINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderBuildings() {
  const panel = document.getElementById('building-panel');
  panel.querySelectorAll('.building-item').forEach(e => e.remove());
  BUILDINGS.forEach(b => {
    const cnt  = state.buildings[b.id];
    const cost = getBldCost(b);
    const affordable = state.score >= cost;
    const cpsC = b.baseCps * cnt * state.bldMult[b.id] * state.prestigeMult;
    const locked = cnt === 0 && cost > state.totalEarned * 5 && !affordable;
    const div = document.createElement('div');
    div.className = 'building-item'
      + (locked ? ' bld-locked' : '')
      + (affordable && !locked ? ' bld-affordable' : '');
    div.dataset.bid = b.id;
    const emoji = b.name.match(/^\S+/)[0];
    const label = b.name.replace(/^\S+\s*/, '');
    div.innerHTML = `
      <div class="bld-icon ${affordable&&!locked?'shimmer':''}">${emoji}</div>
      <div class="bld-body">
        <div class="bld-name">${label}</div>
        <div class="bld-stats"><span class="bld-cost">ü•Å ${fmt(cost)}</span>${cnt>0?` ¬∑ ${fmt(cpsC)}/s`:''}</div>
      </div>
      <div class="bld-count ${cnt>0?'has-items':''}">${cnt||''}</div>
    `;
    if (!locked) div.addEventListener('click', () => buyBuilding(b.id));
    panel.appendChild(div);
  });
}

// ‚îÄ‚îÄ RENDER MILESTONES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderMilestones() {
  const row = document.getElementById('milestone-row');
  row.innerHTML = '';
  MILESTONES.forEach(m => {
    const d = document.createElement('div');
    d.className = 'ms-badge' + (state.milestones[m.id] ? ' done' : '');
    d.textContent = m.label;
    row.appendChild(d);
  });
}

// ‚îÄ‚îÄ UPDATE UI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateUI() {
  document.getElementById('score-num').textContent = fmt(state.score);
  document.getElementById('cps-display').textContent = fmt(state.cps) + ' per second';
  document.getElementById('stat-click').textContent = fmt(getClickPower());
  document.getElementById('stat-cps').textContent = fmt(state.cps);
  document.getElementById('stat-prestige').textContent = state.prestige;
  document.getElementById('header-total').textContent = fmt(state.totalEarned);
  if (state.totalEarned >= 1e6) document.getElementById('prestige-btn').style.display = 'block';

  // XP bar
  const next = MILESTONES.find(m => !state.milestones[m.id]);
  if (!next) {
    document.getElementById('xp-bar').style.width = '100%';
    document.getElementById('xp-label').textContent = 'ALL MILESTONES DONE! üèÜ';
  } else {
    const prev = MILESTONES[MILESTONES.indexOf(next)-1];
    const from = prev ? prev.target : 0;
    const pct = Math.min(100, ((state.totalEarned - from)/(next.target - from))*100);
    document.getElementById('xp-bar').style.width = pct + '%';
    document.getElementById('xp-label').textContent = `Next milestone: ${next.label} bombos`;
  }
}

// ‚îÄ‚îÄ BUY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buyBuilding(id) {
  const b = BUILDINGS.find(x => x.id === id);
  const cost = getBldCost(b);
  if (state.score < cost) return;
  state.score -= cost;
  state.buildings[id]++;
  recalcCps();
  notify(`${b.name} purchased! (${state.buildings[id]})`);
  renderBuildings(); renderUpgrades(); updateUI();
}

function buyUpgrade(id) {
  const u = UPGRADES.find(x => x.id === id);
  if (!u || state.bought[id]) return;
  if (state.score < u.cost) return;
  if (state.totalEarned < u.requires) return;
  state.score -= u.cost;
  state.bought[id] = true;
  u.apply(state);   // ‚Üê applies the effect
  recalcCps();
  notify(`‚ö° ${u.name} unlocked!`);
  renderUpgrades(); renderBuildings(); updateUI();
}

// ‚îÄ‚îÄ CLICK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('bombo-btn').addEventListener('click', function(e) {
  const power = getClickPower();
  addScore(power);
  checkMilestones(); updateUI(); renderBuildings(); renderUpgrades();
  const col = power >= 100 ? '#ffd700' : power >= 10 ? '#a8ff00' : '#ffffff';
  spawnFloat(e.clientX, e.clientY, '+'+fmt(power), col);
  spawnParticles(e.clientX, e.clientY, 10);
  this.classList.add('clicked');
  setTimeout(() => this.classList.remove('clicked'), 100);
});

// ‚îÄ‚îÄ GAME LOOP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let last = Date.now(), autoAcc = 0, throttle = 0;
setInterval(() => {
  const now = Date.now();
  const dt = Math.min((now - last)/1000, 0.5);
  last = now;
  addScore(state.cps * dt);
  autoAcc += state.autoClicks * dt;
  if (autoAcc >= 1) {
    const n = Math.floor(autoAcc); autoAcc -= n;
    addScore(getClickPower() * n);
    const btn = document.getElementById('bombo-btn');
    btn.style.boxShadow = '0 8px 0 #46a302,0 16px 50px rgba(88,204,2,0.9),inset 0 -4px 8px rgba(0,0,0,0.2)';
    setTimeout(() => btn.style.boxShadow = '', 80);
  }
  throttle += dt;
  if (throttle >= 0.15) {
    throttle = 0;
    checkMilestones(); updateUI(); renderBuildings(); renderUpgrades();
  }
}, 50);

// ‚îÄ‚îÄ MILESTONES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function checkMilestones() {
  MILESTONES.forEach(m => {
    if (!state.milestones[m.id] && state.totalEarned >= m.target) {
      state.milestones[m.id] = true;
      notify('üèÜ Milestone: ' + m.label + ' total bombos!');
      renderMilestones();
    }
  });
}

// ‚îÄ‚îÄ PRESTIGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function doPrestige() {
  if (state.totalEarned < 1e6) return;
  if (!confirm('Prestige? All progress resets ‚Äî but you earn a permanent +25% multiplier!')) return;
  state.prestige++;
  state.prestigeMult = 1 + state.prestige * 0.25;
  state.score = 0; state.totalEarned = 0;
  state.clickMult = 1; state.autoClicks = 0; state.goldenTouch = false;
  BUILDINGS.forEach(b => { state.buildings[b.id] = 0; state.bldMult[b.id] = 1; });
  for (const k in state.bought) delete state.bought[k];
  for (const k in state.milestones) delete state.milestones[k];
  recalcCps();
  document.getElementById('prestige-btn').style.display = 'none';
  notify('‚ú® Prestige ' + state.prestige + '! √ó' + state.prestigeMult.toFixed(2) + ' permanent bonus active!');
  renderUpgrades(); renderBuildings(); renderMilestones(); updateUI();
}

// ‚îÄ‚îÄ GOLDEN BOMBO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function spawnGolden() {
  const el = document.createElement('div');
  el.className = 'golden'; el.textContent = 'üåü';
  el.style.left = (8 + Math.random()*76)+'vw';
  el.style.top = (12 + Math.random()*65)+'vh';
  document.body.appendChild(el);
  el.addEventListener('click', () => {
    const bonus = Math.max(500, Math.floor(state.cps * 60 + getClickPower() * 100));
    addScore(bonus);
    notify('üåü Golden Bombo! +' + fmt(bonus) + ' bombos!');
    spawnParticles(el.getBoundingClientRect().left, el.getBoundingClientRect().top, 30, '#ffd700');
    el.remove(); updateUI();
  });
  setTimeout(() => { if (el.parentNode) el.remove(); }, 8000);
}
function scheduleGolden() { setTimeout(() => { spawnGolden(); scheduleGolden(); }, 18000 + Math.random()*22000); }
scheduleGolden();

// ‚îÄ‚îÄ PARTICLES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const cvs = document.getElementById('fx-canvas');
const ctx2 = cvs.getContext('2d');
function rsz() { cvs.width = window.innerWidth; cvs.height = window.innerHeight; }
rsz(); window.addEventListener('resize', rsz);
const parts = [];
function spawnParticles(x, y, n=10, col=null) {
  const cols = ['#58cc02','#ffc800','#1cb0f6','#ff4b4b','#a8ff00'];
  for (let i=0;i<n;i++) parts.push({
    x, y,
    vx:(Math.random()-.5)*8, vy:(Math.random()-.5)*8-2,
    life:1, decay:0.03+Math.random()*0.04,
    r:3+Math.random()*4,
    color:col||cols[Math.floor(Math.random()*cols.length)]
  });
}
(function loop() {
  ctx2.clearRect(0,0,cvs.width,cvs.height);
  for (let i=parts.length-1;i>=0;i--) {
    const p=parts[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=0.25; p.life-=p.decay;
    if (p.life<=0){parts.splice(i,1);continue;}
    ctx2.globalAlpha=p.life; ctx2.fillStyle=p.color;
    ctx2.beginPath(); ctx2.arc(p.x,p.y,p.r,0,Math.PI*2); ctx2.fill();
  }
  ctx2.globalAlpha=1;
  requestAnimationFrame(loop);
})();

// ‚îÄ‚îÄ FLOAT TEXT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function spawnFloat(x, y, text, color='#ffc800') {
  const el = document.createElement('div');
  el.className = 'float-txt'; el.style.color = color;
  el.style.left = (x-20+(Math.random()*40-20))+'px';
  el.style.top = (y-30)+'px'; el.textContent = text;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 1100);
}

// ‚îÄ‚îÄ NOTIFY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let notifT;
function notify(msg) {
  const el = document.getElementById('notif');
  el.textContent = msg; el.classList.add('show');
  clearTimeout(notifT); notifT = setTimeout(() => el.classList.remove('show'), 3000);
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
recalcCps();
renderUpgrades(); renderBuildings(); renderMilestones(); updateUI();
setTimeout(() => notify('ü•Å Click Mi Bombo to earn bombos! Buy buildings for passive income!'), 600);
</script>
</body>
</html>