<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mi Bombo Clicker â€” Duolingo Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800;900&family=Lilita+One&display=swap" rel="stylesheet">
<style>
:root {
  --green:#58cc02; --green-d:#46a302; --green-glow:rgba(88,204,2,0.35);
  --yellow:#ffc800; --yellow-d:#e6b200;
  --red:#ff4b4b; --red-d:#cc0000;
  --blue:#1cb0f6; --blue-d:#1899d6;
  --purple:#9333ea; --purple-d:#7c3aed;
  --orange:#ff9600; --orange-d:#cc7a00;
  --bg:#0f1923; --bg2:#152330; --panel:#192d3a; --panel2:#1f3848; --panel3:#264556;
  --border:#2b4d63; --text:#fff; --muted:#6b9ab8;
  --radius:14px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden}
body{font-family:'Baloo 2',cursive;background:var(--bg);color:var(--text);display:flex;flex-direction:column;overflow:hidden;cursor:default}

/* â•â•â• HEADER â•â•â• */
#hdr{
  background:linear-gradient(90deg,#0d1f2b 0%,#152d3f 50%,#0d1f2b 100%);
  border-bottom:3px solid var(--border);height:54px;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 16px;flex-shrink:0;position:relative;z-index:20;
  box-shadow:0 2px 20px rgba(0,0,0,0.5);
}
#hdr h1{font-family:'Lilita One',cursive;font-size:22px;color:var(--yellow);
  text-shadow:0 2px 0 var(--yellow-d),0 0 20px rgba(255,200,0,0.4);letter-spacing:1px}
.hdr-pills{display:flex;gap:8px}
.hdr-pill{background:var(--panel2);border:2px solid var(--border);border-radius:20px;
  padding:3px 12px;font-size:12px;font-weight:800;display:flex;align-items:center;gap:5px}
.hdr-pill.green{border-color:var(--green);color:var(--green)}
.hdr-pill.yellow{border-color:var(--yellow);color:var(--yellow)}
.hdr-pill.red{border-color:var(--red);color:var(--red)}
#save-indicator{font-size:11px;color:var(--muted);font-weight:700;opacity:0;transition:opacity 0.3s}
#save-indicator.show{opacity:1}

/* â•â•â• TAB BAR â•â•â• */
#tab-bar{
  background:var(--panel);border-bottom:2px solid var(--border);
  display:flex;flex-shrink:0;
}
.tab{flex:1;padding:8px 4px;text-align:center;cursor:pointer;font-weight:800;font-size:12px;
  color:var(--muted);border-bottom:3px solid transparent;transition:all 0.2s;
  letter-spacing:0.5px;text-transform:uppercase}
.tab:hover{color:var(--text);background:var(--panel2)}
.tab.active{color:var(--green);border-bottom-color:var(--green);background:var(--panel2)}
.tab-icon{font-size:16px;display:block;margin-bottom:1px}

/* â•â•â• MAIN LAYOUT â•â•â• */
#main{display:grid;grid-template-columns:256px 1fr 284px;flex:1;overflow:hidden;position:relative}

/* â•â•â• SIDE PANELS â•â•â• */
.sp{background:var(--panel);overflow-y:auto;overflow-x:hidden;
  scrollbar-width:thin;scrollbar-color:var(--border) transparent}
.sp::-webkit-scrollbar{width:4px}
.sp::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}
#left-panel{border-right:3px solid var(--border)}
#right-panel{border-left:3px solid var(--border)}
.ph{padding:10px 14px 7px;font-family:'Lilita One',cursive;font-size:12px;letter-spacing:2px;
  color:var(--muted);text-transform:uppercase;border-bottom:2px solid var(--border);
  position:sticky;top:0;background:var(--panel);z-index:2}

/* â•â•â• UPGRADES â•â•â• */
.upg{display:flex;align-items:center;gap:9px;padding:9px 12px;border-bottom:1px solid var(--border);
  cursor:pointer;transition:background 0.12s;position:relative;overflow:hidden}
.upg::before{content:'';position:absolute;left:0;top:0;bottom:0;width:0;
  background:var(--green);transition:width 0.2s}
.upg:hover:not(.upg-locked):not(.upg-done)::before{width:3px}
.upg:hover:not(.upg-locked):not(.upg-done){background:var(--panel2)}
.upg-locked{opacity:0.28;cursor:default;pointer-events:none}
.upg-done{opacity:0.45;pointer-events:none}
.upg-canafford .upg-ico{box-shadow:0 0 14px var(--green-glow)!important;border-color:var(--green)!important}
.upg-ico{width:44px;height:44px;min-width:44px;border-radius:11px;border:2px solid var(--border);
  display:flex;align-items:center;justify-content:center;font-size:24px;
  background:var(--panel2);flex-shrink:0;transition:box-shadow 0.2s,border-color 0.2s}
.upg-txt{flex:1;min-width:0}
.upg-name{font-weight:800;font-size:12px;line-height:1.3;color:var(--text)}
.upg-desc{font-size:10px;color:var(--muted);line-height:1.3;margin-top:1px}
.upg-price{font-size:10px;font-weight:800;color:var(--yellow);margin-top:2px}
.upg-check{position:absolute;right:9px;top:50%;transform:translateY(-50%);
  background:var(--green);color:#fff;font-size:10px;font-weight:900;
  padding:2px 6px;border-radius:20px}

/* â•â•â• CENTER â•â•â• */
#center{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
  overflow:hidden;padding:14px 16px 10px;gap:10px;position:relative;
  background:radial-gradient(ellipse at 50% 0%,#1c3a50 0%,var(--bg) 65%)}
#score-wrap{text-align:center}
#big-score{font-family:'Lilita One',cursive;font-size:50px;line-height:1;
  color:var(--yellow);text-shadow:0 3px 0 var(--yellow-d),0 0 40px rgba(255,200,0,0.25)}
#big-score.pop{animation:pop 0.13s ease}
@keyframes pop{0%,100%{transform:scale(1)}50%{transform:scale(1.07)}}
#score-sub{font-size:11px;color:var(--muted);font-weight:800;letter-spacing:3px;text-transform:uppercase}
#cps-line{font-size:14px;color:var(--green);font-weight:800;margin-top:3px}

/* CLICK AREA */
#click-area{position:relative;width:210px;height:210px;
  display:flex;align-items:center;justify-content:center;flex-shrink:0}
.ring{position:absolute;border-radius:50%;border:2px solid;animation:rpulse 2s ease-in-out infinite}
.r1{width:208px;height:208px;border-color:rgba(88,204,2,0.12)}
.r2{width:175px;height:175px;border-color:rgba(255,200,0,0.1);animation-delay:0.7s}
.r3{width:142px;height:142px;border-color:rgba(28,176,246,0.08);animation-delay:1.4s}
@keyframes rpulse{0%,100%{transform:scale(1);opacity:0.5}50%{transform:scale(1.06);opacity:1}}
.cglow{position:absolute;width:152px;height:152px;border-radius:50%;
  background:radial-gradient(circle,rgba(88,204,2,0.12) 0%,transparent 70%);
  animation:gbreathe 2.5s ease-in-out infinite}
@keyframes gbreathe{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
#mbtn{position:relative;z-index:2;width:144px;height:144px;border-radius:50%;
  border:5px solid var(--green-d);
  background:radial-gradient(circle at 35% 30%,#d4edda,#82c97a 45%,#3ea035 70%,#1e5a12);
  cursor:pointer;transition:transform 0.08s,box-shadow 0.08s;
  box-shadow:0 8px 0 var(--green-d),0 10px 30px rgba(88,204,2,0.45),
    inset 0 -4px 8px rgba(0,0,0,0.25),inset 0 4px 10px rgba(255,255,255,0.25);
  overflow:hidden;display:flex;align-items:center;justify-content:center;padding:0;outline:none}
#mbtn:hover{box-shadow:0 8px 0 var(--green-d),0 16px 44px rgba(88,204,2,0.65),
  inset 0 -4px 8px rgba(0,0,0,0.25),inset 0 4px 10px rgba(255,255,255,0.3)}
#mbtn.dn{transform:translateY(7px) scale(0.93);
  box-shadow:0 1px 0 var(--green-d),0 3px 12px rgba(88,204,2,0.3),
    inset 0 2px 6px rgba(0,0,0,0.35)}
#mbtn img{width:116px;height:116px;object-fit:contain;pointer-events:none;
  transition:transform 0.08s;filter:drop-shadow(0 3px 6px rgba(0,0,0,0.4))}
#mbtn.dn img{transform:scale(0.91) rotate(-4deg)}

/* COMBO */
#combo-bar{width:100%;max-width:330px}
#combo-track{background:var(--panel2);border:2px solid var(--border);border-radius:20px;padding:3px;height:20px}
#combo-fill{height:100%;border-radius:16px;background:linear-gradient(90deg,var(--orange),#ffdd00);
  transition:width 0.1s,background 0.3s;box-shadow:0 0 8px rgba(255,150,0,0.4);width:0%}
#combo-fill.hot{background:linear-gradient(90deg,#ff3a00,#ff9600)}
#combo-txt{text-align:center;font-size:10px;font-weight:800;color:var(--muted);margin-top:2px;letter-spacing:1px}

/* STAT PILLS */
#stat-row{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
.spill{background:var(--panel2);border:2px solid var(--border);border-radius:20px;
  padding:4px 12px;font-size:11px;font-weight:800;color:var(--muted);
  display:flex;align-items:center;gap:4px}
.spill b{color:var(--text);font-size:12px}

/* XP BAR */
#xpwrap{width:100%;max-width:330px}
#xpbar{height:11px;border-radius:16px;background:linear-gradient(90deg,var(--green),#a8ff00);
  transition:width 0.5s;box-shadow:0 0 8px var(--green-glow);width:0%}
#xplabel{text-align:center;font-size:10px;font-weight:700;color:var(--muted);margin-top:2px;letter-spacing:0.5px}

/* MILESTONE BADGES */
#ms-row{display:flex;gap:5px;flex-wrap:wrap;justify-content:center;max-width:360px}
.ms{background:var(--panel2);border:2px solid var(--border);border-radius:20px;
  padding:3px 9px;font-size:10px;font-weight:800;color:var(--muted);transition:all 0.4s}
.ms.done{border-color:var(--yellow);color:var(--yellow);background:rgba(255,200,0,0.08);
  box-shadow:0 0 10px rgba(255,200,0,0.2)}

/* PRESTIGE */
#prestige-btn{background:linear-gradient(135deg,#9333ea,#e11d7a);
  border:none;border-bottom:4px solid #7c3aed;border-radius:14px;
  padding:9px 24px;color:#fff;font-family:'Lilita One',cursive;font-size:16px;
  letter-spacing:1px;cursor:pointer;box-shadow:0 0 24px rgba(147,51,234,0.45);
  transition:all 0.15s;display:none}
#prestige-btn:hover{transform:scale(1.05);box-shadow:0 0 36px rgba(147,51,234,0.7)}
#prestige-btn:active{transform:translateY(3px);border-bottom-width:1px}

/* â•â•â• BUILDINGS â•â•â• */
.bld{display:flex;align-items:center;border-bottom:2px solid var(--border);
  cursor:pointer;transition:background 0.12s;position:relative;overflow:hidden}
.bld:hover:not(.bld-locked){background:var(--panel2)}
.bld-locked{opacity:0.22;cursor:not-allowed;pointer-events:none}
.bld-afford{background:rgba(88,204,2,0.04)}
.bld-afford::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--green)}
.bld-ico{width:52px;height:52px;min-width:52px;display:flex;align-items:center;justify-content:center;
  font-size:26px;background:var(--panel2);border-right:2px solid var(--border);
  flex-shrink:0;position:relative;overflow:hidden}
.bld-ico.sh::after{content:'';position:absolute;inset:0;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.1),transparent);
  animation:sh 1.5s infinite}
@keyframes sh{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.bld-body{flex:1;padding:7px 9px;min-width:0}
.bld-name{font-weight:800;font-size:12px}
.bld-info{font-size:10px;color:var(--muted);margin-top:2px}
.bld-cost{color:var(--yellow);font-weight:800}
.bld-cnt{width:46px;min-width:46px;text-align:center;font-family:'Lilita One',cursive;
  font-size:24px;color:var(--text);padding-right:8px;flex-shrink:0}
.bld-cnt.hi{color:var(--green)}

/* â•â•â• TAB PAGES â•â•â• */
.tab-page{display:none;width:100%;height:100%;overflow-y:auto;padding:16px}
.tab-page.active-page{display:block}

/* ACHIEVEMENTS */
.ach-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;padding:4px}
.ach-card{background:var(--panel2);border:2px solid var(--border);border-radius:12px;
  padding:12px 8px;text-align:center;transition:all 0.3s;position:relative;overflow:hidden}
.ach-card.unlocked{border-color:var(--yellow);background:rgba(255,200,0,0.06)}
.ach-card.unlocked::after{content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,rgba(255,200,0,0.05) 0%,transparent 60%)}
.ach-icon{font-size:32px;display:block;margin-bottom:6px;filter:grayscale(1);transition:filter 0.3s}
.ach-card.unlocked .ach-icon{filter:none}
.ach-title{font-size:11px;font-weight:800;line-height:1.3}
.ach-hint{font-size:9px;color:var(--muted);margin-top:3px}
.ach-card.locked-ach .ach-icon{opacity:0.3}
.ach-card.locked-ach .ach-title{color:var(--muted)}

/* LEADERBOARD */
#lb-wrap{padding:4px}
#lb-name-form{display:flex;gap:8px;margin-bottom:14px}
#lb-name-input{flex:1;background:var(--panel2);border:2px solid var(--border);border-radius:10px;
  padding:8px 12px;color:var(--text);font-family:'Baloo 2',cursive;font-weight:700;font-size:14px;outline:none}
#lb-name-input:focus{border-color:var(--green)}
#lb-save-btn{background:var(--green);border:none;border-bottom:3px solid var(--green-d);
  border-radius:10px;padding:8px 16px;color:#fff;font-family:'Lilita One',cursive;
  font-size:14px;cursor:pointer;transition:all 0.15s}
#lb-save-btn:active{transform:translateY(2px);border-bottom-width:1px}
.lb-row{display:flex;align-items:center;gap:10px;padding:10px 12px;
  background:var(--panel2);border:2px solid var(--border);border-radius:12px;margin-bottom:6px;
  transition:all 0.3s}
.lb-row.me{border-color:var(--green);background:rgba(88,204,2,0.06)}
.lb-rank{font-family:'Lilita One',cursive;font-size:20px;width:32px;text-align:center;flex-shrink:0}
.lb-rank.gold{color:#ffd700}.lb-rank.silver{color:#c0c0c0}.lb-rank.bronze{color:#cd7f32}
.lb-info{flex:1;min-width:0}
.lb-name-txt{font-weight:800;font-size:13px}
.lb-score-txt{font-size:11px;color:var(--muted)}
.lb-badge{font-size:18px}

/* STATS PAGE */
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:4px}
.stat-card{background:var(--panel2);border:2px solid var(--border);border-radius:12px;padding:14px}
.stat-card-label{font-size:10px;font-weight:800;color:var(--muted);letter-spacing:1px;text-transform:uppercase}
.stat-card-val{font-family:'Lilita One',cursive;font-size:22px;color:var(--yellow);margin-top:4px}
.stat-card-sub{font-size:10px;color:var(--muted);margin-top:2px}

/* SHOP (special upgrades) */
.shop-item{background:var(--panel2);border:2px solid var(--border);border-radius:12px;
  padding:12px;margin-bottom:8px;cursor:pointer;transition:all 0.15s;display:flex;gap:12px;align-items:flex-start}
.shop-item:hover:not(.si-locked){border-color:var(--blue);background:rgba(28,176,246,0.05);transform:translateX(2px)}
.shop-item.si-locked{opacity:0.35;cursor:default;pointer-events:none}
.shop-item.si-bought{opacity:0.5;pointer-events:none;border-color:var(--border)}
.si-ico{font-size:28px;flex-shrink:0;margin-top:2px}
.si-body{flex:1;min-width:0}
.si-name{font-weight:900;font-size:13px}
.si-desc{font-size:11px;color:var(--muted);line-height:1.4;margin-top:3px}
.si-cost{margin-top:5px;font-size:11px;font-weight:800;color:var(--blue)}
.si-bought-tag{background:var(--blue);color:#fff;font-size:10px;font-weight:800;
  padding:2px 8px;border-radius:20px;margin-top:4px;display:inline-block}

/* â•â•â• EVENTS â•â•â• */
#event-banner{position:fixed;top:60px;left:50%;transform:translateX(-50%) translateY(-80px);
  background:linear-gradient(135deg,#b45309,#fbbf24);
  border:3px solid #fcd34d;border-radius:16px;padding:12px 24px;
  font-weight:900;font-size:15px;color:#1a0a00;
  box-shadow:0 8px 30px rgba(0,0,0,0.5),0 0 30px rgba(251,191,36,0.4);
  transition:transform 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
  z-index:300;text-align:center;pointer-events:none;min-width:280px}
#event-banner.show{transform:translateX(-50%) translateY(0)}

/* â•â•â• NOTIFICATION â•â•â• */
#notif{position:fixed;bottom:18px;left:50%;transform:translateX(-50%) translateY(80px);
  background:var(--panel2);border:2px solid var(--green);border-bottom:4px solid var(--green-d);
  border-radius:16px;padding:11px 22px;font-size:14px;font-weight:800;color:#fff;
  box-shadow:0 8px 28px rgba(0,0,0,0.5),0 0 18px var(--green-glow);
  transition:transform 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
  z-index:9999;text-align:center;pointer-events:none;max-width:360px}
#notif.show{transform:translateX(-50%) translateY(0)}

/* â•â•â• ACHIEVEMENT POPUP â•â•â• */
#ach-popup{position:fixed;top:70px;right:-320px;
  background:linear-gradient(135deg,var(--panel2),var(--panel3));
  border:2px solid var(--yellow);border-radius:16px;padding:14px 18px;
  width:280px;box-shadow:0 8px 30px rgba(0,0,0,0.5),0 0 20px rgba(255,200,0,0.2);
  transition:right 0.5s cubic-bezier(0.175,0.885,0.32,1.275);z-index:500}
#ach-popup.show{right:12px}
#ach-popup-ico{font-size:36px;float:left;margin-right:12px}
#ach-popup-title{font-size:10px;font-weight:800;color:var(--yellow);letter-spacing:2px;text-transform:uppercase}
#ach-popup-name{font-family:'Lilita One',cursive;font-size:17px;color:var(--text);line-height:1.2}
#ach-popup-desc{font-size:11px;color:var(--muted);margin-top:3px;clear:both}

/* â•â•â• GOLDEN â•â•â• */
.golden{position:fixed;font-size:48px;cursor:pointer;z-index:800;
  filter:drop-shadow(0 0 16px gold) drop-shadow(0 0 30px orange);
  animation:gfloat 0.9s ease-in-out infinite alternate,gappear 9s forwards;
  user-select:none}
.golden:hover{transform:scale(1.3) rotate(12deg)!important}
@keyframes gfloat{from{transform:translateY(0) rotate(-5deg)}to{transform:translateY(-14px) rotate(5deg)}}
@keyframes gappear{0%{opacity:0;transform:scale(0)}6%{opacity:1;transform:scale(1.2)}10%{transform:scale(1)}85%{opacity:1}100%{opacity:0;pointer-events:none}}

/* â•â•â• DUOLINGO OWL THREAT â•â•â• */
#owl-threat{position:fixed;bottom:-120px;left:50%;transform:translateX(-50%);
  text-align:center;transition:bottom 0.5s cubic-bezier(0.175,0.885,0.32,1.275);
  z-index:400;pointer-events:none}
#owl-threat.show{bottom:0}
#owl-threat-inner{background:var(--red);border:3px solid var(--red-d);
  border-radius:20px 20px 0 0;padding:16px 28px;font-weight:900;font-size:14px;
  box-shadow:0 -8px 30px rgba(255,75,75,0.4);max-width:400px}
#owl-threat-ico{font-size:40px;display:block;margin-bottom:4px}

/* FLOAT TXT */
.ftxt{position:fixed;font-family:'Lilita One',cursive;font-size:20px;pointer-events:none;
  z-index:9999;animation:ftup 1.1s ease-out forwards;text-shadow:0 2px 6px rgba(0,0,0,0.6)}
@keyframes ftup{0%{opacity:1;transform:translateY(0) scale(1)}30%{opacity:1;transform:translateY(-28px) scale(1.12)}100%{opacity:0;transform:translateY(-88px) scale(0.7)}}

/* CANVAS */
#fx{position:fixed;inset:0;pointer-events:none;z-index:200}

/* CRIT TEXT */
.crit{font-size:32px!important;color:#ff4b4b!important;text-shadow:0 0 20px rgba(255,75,75,0.8)!important}

/* MULTIPLIER FLASH */
@keyframes multFlash{0%{transform:scale(1)}30%{transform:scale(1.4)}100%{transform:scale(1)}}
.mult-flash{animation:multFlash 0.4s ease}

/* Reset */
#reset-btn{background:var(--red);border:none;border-bottom:3px solid var(--red-d);
  border-radius:10px;padding:8px 20px;color:#fff;font-family:'Lilita One',cursive;
  font-size:14px;cursor:pointer;transition:all 0.15s}
#reset-btn:active{transform:translateY(2px);border-bottom-width:1px}

/* Offline earnings modal */
#offline-modal{position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:900;
  display:none;align-items:center;justify-content:center}
#offline-modal.show{display:flex}
#offline-box{background:var(--panel);border:3px solid var(--green);border-radius:20px;
  padding:32px;text-align:center;max-width:380px;box-shadow:0 16px 60px rgba(0,0,0,0.6)}
#offline-box h2{font-family:'Lilita One',cursive;font-size:26px;color:var(--yellow);margin-bottom:8px}
#offline-amount{font-family:'Lilita One',cursive;font-size:42px;color:var(--green);
  text-shadow:0 0 20px var(--green-glow);margin:12px 0}
#offline-close{background:var(--green);border:none;border-bottom:4px solid var(--green-d);
  border-radius:12px;padding:12px 32px;color:#fff;font-family:'Lilita One',cursive;
  font-size:18px;cursor:pointer;margin-top:8px;transition:all 0.15s}
#offline-close:active{transform:translateY(3px);border-bottom-width:1px}

/* Scrollbar */
::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}
</style>
</head>
<body>
<canvas id="fx"></canvas>
<div id="notif"></div>
<div id="ach-popup"><span id="ach-popup-ico">ğŸ†</span><div id="ach-popup-title">ACHIEVEMENT UNLOCKED</div><div id="ach-popup-name"></div><div id="ach-popup-desc"></div></div>
<div id="event-banner"></div>
<div id="owl-threat"><div id="owl-threat-inner"><span id="owl-threat-ico">ğŸ¦‰</span><span id="owl-threat-msg"></span></div></div>
<div id="offline-modal"><div id="offline-box">
  <h2>Â¡Bienvenido de vuelta!</h2>
  <div style="font-size:14px;color:var(--muted)">Mi Bombo kept drumming while you were gone.</div>
  <div id="offline-amount">+0</div>
  <div style="font-size:12px;color:var(--muted)">bombos earned while offline</div>
  <button id="offline-close" onclick="closeOffline()">Â¡MUCHAS GRACIAS! ğŸ¥</button>
</div></div>

<!-- HEADER -->
<div id="hdr">
  <h1>ğŸ¥ MI BOMBO CLICKER</h1>
  <div class="hdr-pills">
    <div class="hdr-pill yellow">ğŸ¥ <span id="hdr-score">0</span></div>
    <div class="hdr-pill green">âš¡ <span id="hdr-cps">0</span>/s</div>
    <div class="hdr-pill red">ğŸ”¥ <span id="hdr-streak">x1</span></div>
  </div>
  <div id="save-indicator">ğŸ’¾ Saved!</div>
</div>

<!-- TAB BAR (center section) -->
<div id="tab-bar">
  <div class="tab active" data-tab="game" onclick="switchTab('game')"><span class="tab-icon">ğŸ®</span>Game</div>
  <div class="tab" data-tab="achievements" onclick="switchTab('achievements')"><span class="tab-icon">ğŸ†</span>Achievements</div>
  <div class="tab" data-tab="leaderboard" onclick="switchTab('leaderboard')"><span class="tab-icon">ğŸ‘‘</span>Leaderboard</div>
  <div class="tab" data-tab="stats" onclick="switchTab('stats')"><span class="tab-icon">ğŸ“Š</span>Stats</div>
  <div class="tab" data-tab="shop" onclick="switchTab('shop')"><span class="tab-icon">ğŸ›’</span>Duolingo Shop</div>
</div>

<!-- MAIN -->
<div id="main">
  <!-- LEFT: UPGRADES -->
  <div class="sp" id="left-panel">
    <div class="ph">âš¡ Duolingo Upgrades</div>
    <div id="upg-list"></div>
  </div>

  <!-- CENTER -->
  <div id="center">
    <!-- GAME TAB -->
    <div class="tab-page active-page" id="page-game">
      <div style="display:flex;flex-direction:column;align-items:center;gap:10px;padding-bottom:8px">
        <div id="score-wrap">
          <div id="big-score">0</div>
          <div id="score-sub">BOMBOS</div>
          <div id="cps-line">0 per second</div>
        </div>

        <div id="click-area">
          <div class="ring r1"></div><div class="ring r2"></div><div class="ring r3"></div>
          <div class="cglow"></div>
          <button id="mbtn">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSOkcxljKS9eYc1PPQXz4TXbzpq7dyLEH5MHg&s" alt="Mi Bombo" id="bombo-img">
          </button>
        </div>

        <div id="combo-bar">
          <div id="combo-track"><div id="combo-fill"></div></div>
          <div id="combo-txt">COMBO: x1</div>
        </div>

        <div id="stat-row">
          <div class="spill">ğŸ‘† <b id="s-click">1</b></div>
          <div class="spill">âš¡ <b id="s-cps">0</b>/s</div>
          <div class="spill">âœ¨ <b id="s-pres" style="color:#e11d7a">0</b> prestige</div>
          <div class="spill">ğŸ”¥ <b id="s-streak">x1</b></div>
        </div>

        <div id="xpwrap">
          <div style="background:var(--panel2);border:2px solid var(--border);border-radius:20px;padding:3px">
            <div id="xpbar"></div>
          </div>
          <div id="xplabel">Next milestone: 10</div>
        </div>

        <div id="ms-row"></div>
        <button id="prestige-btn" onclick="doPrestige()">âœ¨ PRESTIGE âœ¨</button>
      </div>
    </div>

    <!-- ACHIEVEMENTS TAB -->
    <div class="tab-page" id="page-achievements">
      <h2 style="font-family:'Lilita One',cursive;color:var(--yellow);margin-bottom:12px;font-size:18px">ğŸ† Achievements <span id="ach-count" style="font-size:14px;color:var(--muted)"></span></h2>
      <div class="ach-grid" id="ach-grid"></div>
    </div>

    <!-- LEADERBOARD TAB -->
    <div class="tab-page" id="page-leaderboard">
      <h2 style="font-family:'Lilita One',cursive;color:var(--yellow);margin-bottom:12px;font-size:18px">ğŸ‘‘ Leaderboard</h2>
      <div id="lb-wrap">
        <div id="lb-name-form">
          <input type="text" id="lb-name-input" placeholder="Your name..." maxlength="20">
          <button id="lb-save-btn" onclick="saveToLeaderboard()">SUBMIT ğŸ¥</button>
        </div>
        <div id="lb-list"></div>
        <div style="font-size:11px;color:var(--muted);text-align:center;margin-top:8px">Scores saved locally on this device</div>
      </div>
    </div>

    <!-- STATS TAB -->
    <div class="tab-page" id="page-stats">
      <h2 style="font-family:'Lilita One',cursive;color:var(--yellow);margin-bottom:12px;font-size:18px">ğŸ“Š Statistics</h2>
      <div class="stats-grid" id="stats-grid"></div>
      <div style="margin-top:16px;text-align:center">
        <button id="reset-btn" onclick="resetGame()">ğŸ—‘ï¸ Reset Game</button>
      </div>
    </div>

    <!-- SHOP TAB -->
    <div class="tab-page" id="page-shop">
      <h2 style="font-family:'Lilita One',cursive;color:var(--yellow);margin-bottom:4px;font-size:18px">ğŸ›’ Duolingo Shop</h2>
      <div style="font-size:11px;color:var(--muted);margin-bottom:12px">Spend your hard-earned bombos on powerful upgrades!</div>
      <div id="shop-list"></div>
    </div>
  </div>

  <!-- RIGHT: BUILDINGS -->
  <div class="sp" id="right-panel">
    <div class="ph">ğŸ—ï¸ Production</div>
    <div id="bld-list"></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA DEFINITIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const BUILDINGS = [
  {id:'shaker',   name:'ğŸª‡ Shaker',            desc:'A tiny rattle. Duolingo approves.', baseCost:10,       baseCps:0.1 },
  {id:'tamb',     name:'ğŸª˜ Tambourine',         desc:'Ole! Jingle jingle!', baseCost:100,      baseCps:0.5 },
  {id:'drummer',  name:'ğŸ¥ Street Drummer',     desc:'Banging for XP since 2015.', baseCost:500,      baseCps:2   },
  {id:'band',     name:'ğŸ· Brass Band',         desc:'Your whole neighborhood has joined.', baseCost:2500,     baseCps:8   },
  {id:'studio',   name:'ğŸ™ï¸ Recording Studio',  desc:'Record-breaking production!', baseCost:12000,    baseCps:30  },
  {id:'festival', name:'ğŸª Bombo Festival',     desc:'Millions attend. Duo is proud.', baseCost:60000,    baseCps:100 },
  {id:'radio',    name:'ğŸ“» Radio Empire',       desc:'Your beats on every station.', baseCost:300000,   baseCps:400 },
  {id:'factory',  name:'ğŸ­ Beat Factory',       desc:'Industrial percussion. OSHA violations.', baseCost:1500000,  baseCps:1500},
  {id:'satellite',name:'ğŸ›¸ Orbital Drum Sat.',  desc:'Broadcasting from SPACE.', baseCost:10000000, baseCps:6000},
  {id:'dimension',name:'ğŸŒ€ Rhythm Dimension',   desc:'Beats from alternate universes.', baseCost:75000000, baseCps:25000},
];

// Upgrades with funny Duolingo-themed names
const UPGRADES = [
  {id:'u1',  ico:'ğŸª¢', name:"You Didn't Practice",          desc:'Guilt trip â†’ +2Ã— click power. Duo\'s watching.',              cost:100,      req:0,     apply:s=>{s.clickMult*=2}},
  {id:'u2',  ico:'ğŸ’€', name:"Duo's Angry Face",             desc:'Pure fear makes you click 3Ã— faster.',                        cost:800,      req:50,    apply:s=>{s.clickMult*=3}},
  {id:'u3',  ico:'â˜•', name:"Lingot-Infused CafÃ©",          desc:'5Ã— click power. It\'s the caffeine.',                         cost:5000,     req:200,   apply:s=>{s.clickMult*=5}},
  {id:'u4',  ico:'ğŸ†', name:"500 Day Streak Trophy",        desc:'You earned this. 10Ã— click power.',                           cost:50000,    req:1000,  apply:s=>{s.clickMult*=10}},
  {id:'u5',  ico:'ğŸ¦¾', name:"Super Duo Robot Arms",         desc:'Duo\'s final form. +20Ã— click power.',                        cost:500000,   req:5000,  apply:s=>{s.clickMult*=20}},
  {id:'u6',  ico:'âœ¨', name:"CPS-to-Click Conversion",      desc:'Each click gains +3% of your CPS.',                           cost:25000,    req:500,   apply:s=>{s.goldenTouch=true}},
  {id:'u7',  ico:'ğŸ¤–', name:"Auto-Tapper Mk1",              desc:'+3 automatic clicks/sec. Very helpful.',                      cost:400,      req:0,     apply:s=>{s.autoClicks+=3}},
  {id:'u8',  ico:'ğŸ¦¿', name:"Auto-Tapper Mk2 (Pro)",        desc:'+10 auto clicks/sec. Duo is proud.',                          cost:8000,     req:100,   apply:s=>{s.autoClicks+=10}},
  {id:'u9',  ico:'ğŸŒ', name:"Auto-Tapper Mk3 (Extreme)",    desc:'+30 auto clicks/sec. Why do you still exist?',                cost:100000,   req:1000,  apply:s=>{s.autoClicks+=30}},
  {id:'u10', ico:'ğŸª‡', name:"Shaker Lesson Complete âœ“",     desc:'Shakers produce 2Ã— more. A+.',                               cost:300,      req:0,     apply:s=>{s.bm.shaker*=2}},
  {id:'u11', ico:'ğŸª˜', name:"Tambourine Streak Bonus",      desc:'Tambourines produce 2Ã— more.',                                cost:2000,     req:0,     apply:s=>{s.bm.tamb*=2}},
  {id:'u12', ico:'ğŸ¥', name:"Drummer Placement Test",       desc:'Street Drummers produce 2Ã— more.',                           cost:10000,    req:0,     apply:s=>{s.bm.drummer*=2}},
  {id:'u13', ico:'ğŸ·', name:"Band Advanced Course",         desc:'Brass Bands produce 2Ã— more.',                               cost:50000,    req:0,     apply:s=>{s.bm.band*=2}},
  {id:'u14', ico:'ğŸ™ï¸', name:"Studio Platinum Award",       desc:'Studios produce 2Ã— more.',                                   cost:200000,   req:0,     apply:s=>{s.bm.studio*=2}},
  {id:'u15', ico:'ğŸª', name:"Festival VIP Pass",            desc:'Festivals produce 2Ã— more.',                                 cost:1000000,  req:0,     apply:s=>{s.bm.festival*=2}},
  {id:'u16', ico:'ğŸ“»', name:"Radio Broadcasting License",   desc:'Radio Empires produce 2Ã— more.',                             cost:5000000,  req:0,     apply:s=>{s.bm.radio*=2}},
  {id:'u17', ico:'ğŸ”Š', name:"Duo's Mega Bass",              desc:'ALL buildings produce 1.5Ã— more. BOOM.',                     cost:500000,   req:5000,  apply:s=>{for(let k in s.bm)s.bm[k]*=1.5}},
  {id:'u18', ico:'ğŸ¦‰', name:"Duo Said So",                  desc:'EVERYTHING Ã—2. You missed a lesson. This is your punishment.',cost:5000000, req:50000, apply:s=>{for(let k in s.bm)s.bm[k]*=2;s.clickMult*=2}},
  {id:'u19', ico:'ğŸ’', name:"Diamond League Champion",      desc:'CPS-to-click bonus tripled.',                                 cost:2000000,  req:10000, apply:s=>{s.goldenBonus=(s.goldenBonus||0.03)+0.06}},
  {id:'u20', ico:'ğŸŒ™', name:"Night Owl Certification",      desc:'All building multipliers Ã—2 more.',                          cost:20000000, req:100000,apply:s=>{for(let k in s.bm)s.bm[k]*=2}},
];

// Shop items (bigger, one-time special effects)
const SHOP_ITEMS = [
  {id:'s1', ico:'ğŸ¦‰', name:"Hire Duo as Manager",     desc:'Duo personally oversees all production. Permanent +50% CPS.', cost:50000,   req:1000,   apply:s=>{s.shopMult=(s.shopMult||1)*1.5}},
  {id:'s2', ico:'â°', name:"Time Warp Practice",      desc:'Speed up time for 60 seconds â€” 10Ã— production temporarily!', cost:100000,  req:2000,   apply:s=>{activateTimeWarp()}},
  {id:'s3', ico:'ğŸ–ï¸', name:"Lingot Multiplier",       desc:'Permanent Ã—2 on ALL clicks and production.',                  cost:250000,  req:5000,   apply:s=>{s.shopMult=(s.shopMult||1)*2}},
  {id:'s4', ico:'ğŸŒ', name:"World Spanish Tour",       desc:'Mi Bombo tours the world. Adds 5000 permanent CPS bonus.',   cost:1000000, req:10000,  apply:s=>{s.bonusCps=(s.bonusCps||0)+5000}},
  {id:'s5', ico:'ğŸ¤', name:"Duo Friendship Bond",     desc:'You and Duo are friends now. Ã—3 all click power.',            cost:500000,  req:5000,   apply:s=>{s.clickMult*=3}},
  {id:'s6', ico:'ğŸ¯', name:"Perfect Lesson Streak",   desc:'Critical clicks now do 20Ã— damage (was 10Ã—).',               cost:300000,  req:3000,   apply:s=>{s.critMult=20}},
  {id:'s7', ico:'ğŸ…', name:"Golden Owl Award",        desc:'Golden Bombo events give 3Ã— more bombos.',                    cost:200000,  req:2000,   apply:s=>{s.goldenMult=(s.goldenMult||1)*3}},
  {id:'s8', ico:'ğŸš€', name:"Rocket Launch Lesson",    desc:'Adds Orbital Drum Satellite Ã—3 multiplier.',                  cost:5000000, req:50000,  apply:s=>{s.bm.satellite=(s.bm.satellite||1)*3}},
];

// Achievements
const ACHIEVEMENTS = [
  {id:'a1',  ico:'ğŸ¥', name:"First Drum",            desc:'Click Mi Bombo for the first time.',         check:s=>s.totalClicks>=1},
  {id:'a2',  ico:'ğŸ’¯', name:"100 Club",               desc:'Earn 100 total bombos.',                     check:s=>s.totalEarned>=100},
  {id:'a3',  ico:'ğŸ¯', name:"Getting Serious",        desc:'Earn 10,000 total bombos.',                  check:s=>s.totalEarned>=10000},
  {id:'a4',  ico:'ğŸŒŸ', name:"Lingot Millionaire",     desc:'Earn 1,000,000 total bombos.',               check:s=>s.totalEarned>=1e6},
  {id:'a5',  ico:'ğŸ”¥', name:"On Fire",                desc:'Reach a 10Ã— combo streak.',                  check:s=>s.maxCombo>=10},
  {id:'a6',  ico:'ğŸ’«', name:"Speed Demon",            desc:'Click 100 times in one session.',            check:s=>s.totalClicks>=100},
  {id:'a7',  ico:'ğŸ—ï¸', name:"Builder",               desc:'Buy your first building.',                   check:s=>Object.values(s.buildings).some(v=>v>0)},
  {id:'a8',  ico:'ğŸ°', name:"Empire",                 desc:'Own 50 buildings total.',                    check:s=>Object.values(s.buildings).reduce((a,b)=>a+b,0)>=50},
  {id:'a9',  ico:'ğŸŒ', name:"Domination",             desc:'Own 200 buildings total.',                   check:s=>Object.values(s.buildings).reduce((a,b)=>a+b,0)>=200},
  {id:'a10', ico:'âš¡', name:"Upgrade Addict",          desc:'Buy 5 upgrades.',                            check:s=>Object.keys(s.bought).length>=5},
  {id:'a11', ico:'ğŸ’', name:"Diamond Hands",          desc:'Buy all upgrades.',                          check:s=>Object.keys(s.bought).length>=UPGRADES.length},
  {id:'a12', ico:'ğŸŒŸ', name:"Golden Hunter",          desc:'Catch a Golden Bombo.',                      check:s=>s.goldensCaught>=1},
  {id:'a13', ico:'ğŸ†', name:"Golden Champion",        desc:'Catch 10 Golden Bombos.',                    check:s=>s.goldensCaught>=10},
  {id:'a14', ico:'âœ¨', name:"First Prestige",         desc:'Prestige for the first time.',               check:s=>s.prestige>=1},
  {id:'a15', ico:'ğŸŒˆ', name:"Legend",                 desc:'Prestige 5 times.',                          check:s=>s.prestige>=5},
  {id:'a16', ico:'ğŸ¥‡', name:"Leaderboard Star",       desc:'Submit your score to the leaderboard.',      check:s=>s.leaderboardSubmitted},
  {id:'a17', ico:'ğŸŒ™', name:"Night Owl",              desc:'Have CPS over 1,000.',                       check:s=>s.cps>=1000},
  {id:'a18', ico:'ğŸš€', name:"To the Moon",            desc:'Have CPS over 100,000.',                     check:s=>s.cps>=100000},
  {id:'a19', ico:'ğŸª', name:"Festival Organizer",     desc:'Own 20 Bombo Festivals.',                    check:s=>s.buildings.festival>=20},
  {id:'a20', ico:'ğŸ­', name:"Auto Pilot",             desc:'Have 20+ auto clicks/sec.',                  check:s=>s.autoClicks>=20},
  {id:'a21', ico:'ğŸ”±', name:"10 Billion Club",        desc:'Earn 10 billion total bombos.',              check:s=>s.totalEarned>=1e10},
  {id:'a22', ico:'ğŸ¦‰', name:"Duo\'s Best Friend",     desc:'Buy something from the Duolingo Shop.',      check:s=>s.shopBought.length>=1},
  {id:'a23', ico:'ğŸ’€', name:"Skull Mode",             desc:'Earn 1 trillion total bombos.',              check:s=>s.totalEarned>=1e12},
  {id:'a24', ico:'ğŸŒº', name:"Survived Duo",           desc:'Survive the owl threat.',                    check:s=>s.owlThreatsSurvived>=1},
];

const MILESTONES = [
  {id:'m1',  label:'10',   target:10},
  {id:'m2',  label:'100',  target:100},
  {id:'m3',  label:'1K',   target:1000},
  {id:'m4',  label:'10K',  target:10000},
  {id:'m5',  label:'100K', target:1e5},
  {id:'m6',  label:'1M',   target:1e6},
  {id:'m7',  label:'10M',  target:1e7},
  {id:'m8',  label:'1B',   target:1e9},
  {id:'m9',  label:'1T',   target:1e12},
];

const OWL_THREATS = [
  "You haven't practiced today. I know where you live. ğŸ ",
  "Interesting. I set your house on fire. Keep clicking. ğŸ”¥",
  "Your family has been notified of your lack of practice.",
  "I will end you if you stop clicking. Love, Duo ğŸ’š",
  "CLICK FASTER. I AM WATCHING YOU. ALWAYS. ğŸ‘ï¸",
  "This is your final warning. Click more. Do it now.",
  "I've already called your mother. She's disappointed. ğŸ“",
  "You think you can outrun me? Click HARDER.",
  "Mi Bombo says hi. Also click faster or else. ğŸ¥",
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEFAULT_STATE = () => ({
  score:0, totalEarned:0, totalClicks:0,
  clickMult:1, autoClicks:0, goldenTouch:false, goldenBonus:0.03,
  critMult:10, bonusCps:0, shopMult:1,
  cps:0, prestige:0, prestigeMult:1,
  combo:1, comboTimer:0, maxCombo:1,
  goldensCaught:0, leaderboardSubmitted:false,
  owlThreatsSurvived:0,
  sessionStart:Date.now(),
  lastSave:Date.now(),
  buildings: Object.fromEntries(BUILDINGS.map(b=>[b.id,0])),
  bm: Object.fromEntries(BUILDINGS.map(b=>[b.id,1])),
  bought:{}, shopBought:[], achDone:{}, milestones:{},
  stats:{
    goldenClicks:0, totalBuildingsBought:0,
    upgradesBought:0, timeWarpUsed:0,
    sessionClicks:0,
  }
});

let S = DEFAULT_STATE();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SAVE / LOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveGame() {
  S.lastSave = Date.now();
  localStorage.setItem('mibombo_v3', JSON.stringify(S));
  const ind = document.getElementById('save-indicator');
  ind.classList.add('show');
  setTimeout(() => ind.classList.remove('show'), 1500);
}

function loadGame() {
  const raw = localStorage.getItem('mibombo_v3');
  if (!raw) return;
  try {
    const saved = JSON.parse(raw);
    // Merge with defaults to handle new fields
    S = Object.assign(DEFAULT_STATE(), saved);
    // Make sure bm has all buildings
    BUILDINGS.forEach(b => { if (!(b.id in S.bm)) S.bm[b.id] = 1; });
    // Make sure buildings has all
    BUILDINGS.forEach(b => { if (!(b.id in S.buildings)) S.buildings[b.id] = 0; });
    // Check offline earnings
    const offlineSecs = Math.min((Date.now() - (S.lastSave||Date.now())) / 1000, 3600*8);
    recalcCps();
    if (offlineSecs > 10 && S.cps > 0) {
      const earned = S.cps * offlineSecs * 0.5; // 50% offline efficiency
      S.score += earned;
      S.totalEarned += earned;
      document.getElementById('offline-amount').textContent = '+' + fmt(earned);
      document.getElementById('offline-modal').classList.add('show');
    }
  } catch(e) { console.warn('Save corrupted, resetting', e); }
}

function closeOffline() {
  document.getElementById('offline-modal').classList.remove('show');
}

function resetGame() {
  if (!confirm('Reset ALL progress? This cannot be undone!')) return;
  S = DEFAULT_STATE();
  localStorage.removeItem('mibombo_v3');
  notify('ğŸ—‘ï¸ Game reset! Start fresh!');
  recalcCps(); renderAll(); updateUI();
}

// Auto-save every 15s
setInterval(saveGame, 15000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function recalcCps() {
  let c = 0;
  BUILDINGS.forEach(b => { c += b.baseCps * S.buildings[b.id] * S.bm[b.id]; });
  c += (S.bonusCps || 0);
  S.cps = c * S.prestigeMult * (S.shopMult || 1);
}

function getClickPower() {
  let p = Math.max(1, S.clickMult) * S.prestigeMult * (S.shopMult || 1);
  if (S.goldenTouch) p += S.cps * (S.goldenBonus || 0.03);
  return Math.max(1, p);
}

function addScore(n) { S.score += n; S.totalEarned += n; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMBO SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const COMBO_MAX_TIME = 2.5;
function addCombo() {
  S.combo = Math.min(S.combo + 0.2, 20);
  if (S.combo > S.maxCombo) S.maxCombo = S.combo;
  S.comboTimer = COMBO_MAX_TIME;
  updateComboBar();
}
function decayCombo(dt) {
  S.comboTimer -= dt;
  if (S.comboTimer <= 0) { S.combo = Math.max(1, S.combo - dt*3); S.comboTimer = 0; }
  updateComboBar();
}
function updateComboBar() {
  const fill = document.getElementById('combo-fill');
  const pct = ((S.combo - 1) / 19) * 100;
  fill.style.width = pct + '%';
  fill.className = S.combo >= 10 ? 'hot' : '';
  document.getElementById('combo-txt').textContent = `COMBO: Ã—${S.combo.toFixed(1)}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIME WARP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let timeWarpActive = false, timeWarpEnd = 0;
function activateTimeWarp() {
  timeWarpActive = true;
  timeWarpEnd = Date.now() + 60000;
  S.stats.timeWarpUsed++;
  showEvent('â° TIME WARP ACTIVE! 10Ã— production for 60 seconds!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLICK HANDLER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const mbtn = document.getElementById('mbtn');
mbtn.addEventListener('click', function(e) {
  S.totalClicks++; S.stats.sessionClicks++;
  const base = getClickPower() * S.combo;
  // Crit chance 5%
  const isCrit = Math.random() < 0.05;
  const power = isCrit ? base * (S.critMult || 10) : base;
  addScore(power);
  addCombo();
  checkAchievements(); checkMilestones(); updateUI();
  renderBuildingsFast(); renderUpgradesFast();

  // Visuals
  const col = isCrit ? '#ff4b4b' : power > 1000 ? '#ffd700' : power > 100 ? '#a8ff00' : '#ffffff';
  const txt = (isCrit ? 'ğŸ’¥ CRIT! ' : '+') + fmt(power);
  spawnFloat(e.clientX, e.clientY, txt, col, isCrit);
  spawnParticles(e.clientX, e.clientY, isCrit ? 20 : 8, isCrit ? '#ff4b4b' : null);

  this.classList.add('dn');
  setTimeout(() => this.classList.remove('dn'), 95);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BUY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buyBuilding(id) {
  const b = BUILDINGS.find(x => x.id === id);
  const cost = Math.floor(b.baseCost * Math.pow(1.15, S.buildings[id]));
  if (S.score < cost) return;
  S.score -= cost;
  S.buildings[id]++;
  S.stats.totalBuildingsBought++;
  recalcCps();
  notify(`${b.name} purchased! (${S.buildings[id]})`);
  checkAchievements(); updateUI();
  renderBuildings(); renderUpgrades();
  saveGame();
}

function buyUpgrade(id) {
  const u = UPGRADES.find(x => x.id === id);
  if (!u || S.bought[id]) return;
  if (S.score < u.cost || S.totalEarned < u.req) return;
  S.score -= u.cost;
  S.bought[id] = true;
  S.stats.upgradesBought++;
  u.apply(S);
  recalcCps();
  notify(`âš¡ ${u.name} unlocked!`);
  checkAchievements(); updateUI();
  renderUpgrades(); renderBuildings();
  saveGame();
}

function buyShopItem(id) {
  const item = SHOP_ITEMS.find(x => x.id === id);
  if (!item || S.shopBought.includes(id)) return;
  if (S.score < item.cost || S.totalEarned < item.req) return;
  S.score -= item.cost;
  S.shopBought.push(id);
  item.apply(S);
  recalcCps();
  notify(`ğŸ›’ ${item.name} purchased!`);
  checkAchievements(); updateUI(); renderShop(); saveGame();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRESTIGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doPrestige() {
  if (S.totalEarned < 1e6) return;
  if (!confirm('PRESTIGE? You lose all progress but gain +25% permanent multiplier per prestige!\n\nThis cannot be undone.')) return;
  S.prestige++;
  S.prestigeMult = 1 + S.prestige * 0.25;
  const prestige = S.prestige;
  const pm = S.prestigeMult;
  const achDone = {...S.achDone};
  S = DEFAULT_STATE();
  S.prestige = prestige; S.prestigeMult = pm; S.achDone = achDone;
  recalcCps();
  document.getElementById('prestige-btn').style.display = 'none';
  notify(`âœ¨ Prestige ${S.prestige}! Ã—${S.prestigeMult.toFixed(2)} permanent bonus!`);
  saveGame(); renderAll(); updateUI();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let last = Date.now(), autoAcc = 0, uiTimer = 0, saveTimer = 0;
setInterval(() => {
  const now = Date.now();
  const dt = Math.min((now - last)/1000, 0.5);
  last = now;

  const warp = (timeWarpActive && now < timeWarpEnd) ? 10 : 1;
  if (timeWarpActive && now >= timeWarpEnd) { timeWarpActive = false; showEvent('â° Time Warp ended!'); }

  addScore(S.cps * dt * warp);
  decayCombo(dt);

  autoAcc += S.autoClicks * dt;
  if (autoAcc >= 1) {
    const n = Math.floor(autoAcc); autoAcc -= n;
    addScore(getClickPower() * n * S.combo);
    const btn = document.getElementById('mbtn');
    btn.style.boxShadow = '0 8px 0 #46a302,0 16px 50px rgba(88,204,2,0.9),inset 0 -4px 8px rgba(0,0,0,0.2)';
    setTimeout(() => btn.style.boxShadow = '', 80);
  }

  uiTimer += dt;
  if (uiTimer >= 0.15) {
    uiTimer = 0;
    checkMilestones(); checkAchievements(); updateUI();
    if (currentTab === 'game') { renderBuildingsFast(); renderUpgradesFast(); }
  }
}, 50);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACHIEVEMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkAchievements() {
  ACHIEVEMENTS.forEach(a => {
    if (!S.achDone[a.id] && a.check(S)) {
      S.achDone[a.id] = true;
      showAchPopup(a);
      renderAchievements();
    }
  });
}

let achPopTimer;
function showAchPopup(a) {
  document.getElementById('ach-popup-ico').textContent = a.ico;
  document.getElementById('ach-popup-name').textContent = a.name;
  document.getElementById('ach-popup-desc').textContent = a.desc;
  const pop = document.getElementById('ach-popup');
  pop.classList.add('show');
  clearTimeout(achPopTimer);
  achPopTimer = setTimeout(() => pop.classList.remove('show'), 4000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MILESTONES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkMilestones() {
  MILESTONES.forEach(m => {
    if (!S.milestones[m.id] && S.totalEarned >= m.target) {
      S.milestones[m.id] = true;
      notify('ğŸ† Milestone: ' + m.label + ' bombos reached!');
      renderMilestones();
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OWL THREATS (every 90s)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let owlShown = false;
function showOwlThreat() {
  const msg = OWL_THREATS[Math.floor(Math.random() * OWL_THREATS.length)];
  document.getElementById('owl-threat-msg').textContent = msg;
  const el = document.getElementById('owl-threat');
  el.classList.add('show');
  setTimeout(() => {
    el.classList.remove('show');
    S.owlThreatsSurvived++;
    checkAchievements();
  }, 5000);
}
function scheduleOwl() { setTimeout(() => { showOwlThreat(); scheduleOwl(); }, 90000 + Math.random()*60000); }
scheduleOwl();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOLDEN BOMBO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function spawnGolden() {
  const el = document.createElement('div');
  el.className = 'golden'; el.textContent = 'ğŸŒŸ';
  el.style.left = (8 + Math.random()*76)+'vw';
  el.style.top = (12 + Math.random()*65)+'vh';
  document.body.appendChild(el);
  el.addEventListener('click', () => {
    const bonus = Math.floor(Math.max(500, (S.cps * 60 + getClickPower() * 100)) * (S.goldenMult||1));
    addScore(bonus); S.goldensCaught++; S.stats.goldenClicks++;
    notify('ğŸŒŸ Golden Bombo! +' + fmt(bonus) + ' bombos!');
    spawnParticles(el.getBoundingClientRect().left, el.getBoundingClientRect().top, 35, '#ffd700');
    el.remove(); checkAchievements(); updateUI();
  });
  setTimeout(() => { if (el.parentNode) el.remove(); }, 9000);
}
function scheduleGolden() { setTimeout(() => { spawnGolden(); scheduleGolden(); }, 20000 + Math.random()*25000); }
scheduleGolden();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LEADERBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getLeaderboard() {
  try { return JSON.parse(localStorage.getItem('mibombo_lb') || '[]'); }
  catch(e) { return []; }
}
function saveToLeaderboard() {
  const name = document.getElementById('lb-name-input').value.trim();
  if (!name) { notify('Enter your name first!'); return; }
  const lb = getLeaderboard();
  // Remove old entry for same name
  const idx = lb.findIndex(e => e.name === name);
  if (idx >= 0) lb.splice(idx, 1);
  lb.push({ name, score: Math.floor(S.totalEarned), prestige: S.prestige, date: Date.now() });
  lb.sort((a,b) => b.score - a.score);
  const top = lb.slice(0,20);
  localStorage.setItem('mibombo_lb', JSON.stringify(top));
  S.leaderboardSubmitted = true;
  checkAchievements();
  notify('ğŸ† Score submitted to leaderboard!');
  renderLeaderboard();
  saveGame();
}
function renderLeaderboard() {
  const lb = getLeaderboard();
  const list = document.getElementById('lb-list');
  if (!list) return;
  if (!lb.length) { list.innerHTML = '<div style="text-align:center;color:var(--muted);padding:20px;font-weight:800">No scores yet! Be the first! ğŸ¥</div>'; return; }
  const myName = document.getElementById('lb-name-input')?.value?.trim();
  list.innerHTML = lb.map((e, i) => {
    const rankClass = i===0?'gold':i===1?'silver':i===2?'bronze':'';
    const rankEmoji = i===0?'ğŸ¥‡':i===1?'ğŸ¥ˆ':i===2?'ğŸ¥‰':`${i+1}.`;
    const isMe = e.name === myName;
    const badges = e.prestige > 0 ? 'âœ¨'.repeat(Math.min(e.prestige,5)) : '';
    return `<div class="lb-row ${isMe?'me':''}">
      <div class="lb-rank ${rankClass}">${rankEmoji}</div>
      <div class="lb-info">
        <div class="lb-name-txt">${e.name} ${badges}</div>
        <div class="lb-score-txt">ğŸ¥ ${fmt(e.score)} bombos Â· ${e.prestige} prestige</div>
      </div>
      <div class="lb-badge">${e.prestige>=5?'ğŸŒˆ':e.prestige>=3?'ğŸ’':e.prestige>=1?'âœ¨':'ğŸ¥'}</div>
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fmt(n) {
  n = Math.max(0, n);
  if (n >= 1e15) return (n/1e15).toFixed(2)+'Qa';
  if (n >= 1e12) return (n/1e12).toFixed(2)+'T';
  if (n >= 1e9)  return (n/1e9).toFixed(2)+'B';
  if (n >= 1e6)  return (n/1e6).toFixed(2)+'M';
  if (n >= 1e3)  return (n/1e3).toFixed(1)+'K';
  return Math.floor(n).toLocaleString();
}

function renderUpgrades() {
  const list = document.getElementById('upg-list');
  if (!list) return;
  list.innerHTML = '';
  UPGRADES.forEach(u => {
    const done = !!S.bought[u.id];
    const unlocked = S.totalEarned >= u.req;
    const afford = unlocked && S.score >= u.cost;
    const div = document.createElement('div');
    div.className = 'upg'
      + (done ? ' upg-done' : '')
      + (!done && !unlocked ? ' upg-locked' : '')
      + (!done && afford ? ' upg-canafford' : '');
    div.innerHTML = `<div class="upg-ico">${u.ico}</div>
      <div class="upg-txt">
        <div class="upg-name">${u.name}</div>
        <div class="upg-desc">${u.desc}</div>
        ${!done ? `<div class="upg-price">ğŸ¥ ${fmt(u.cost)}</div>` : ''}
      </div>
      ${done ? '<div class="upg-check">âœ“</div>' : ''}`;
    if (!done && unlocked) div.addEventListener('click', () => buyUpgrade(u.id));
    list.appendChild(div);
  });
}

// Fast upgrade refresh (only update affordability classes)
function renderUpgradesFast() {
  document.querySelectorAll('#upg-list .upg').forEach((div, i) => {
    const u = UPGRADES[i]; if (!u) return;
    const done = !!S.bought[u.id];
    if (done) return;
    const afford = S.totalEarned >= u.req && S.score >= u.cost;
    div.classList.toggle('upg-canafford', afford);
  });
}

function renderBuildings() {
  const list = document.getElementById('bld-list');
  if (!list) return;
  list.innerHTML = '';
  BUILDINGS.forEach(b => {
    const cnt = S.buildings[b.id] || 0;
    const cost = Math.floor(b.baseCost * Math.pow(1.15, cnt));
    const afford = S.score >= cost;
    const cpsC = b.baseCps * cnt * S.bm[b.id] * S.prestigeMult * (S.shopMult||1);
    const locked = cnt === 0 && cost > S.totalEarned * 6 && !afford;
    const emoji = b.name.match(/^\S+/)[0];
    const label = b.name.replace(/^\S+\s*/,'');
    const div = document.createElement('div');
    div.className = 'bld'
      + (locked ? ' bld-locked' : '')
      + (afford && !locked ? ' bld-afford' : '');
    div.dataset.bid = b.id;
    div.innerHTML = `<div class="bld-ico ${afford&&!locked?'sh':''}">${emoji}</div>
      <div class="bld-body">
        <div class="bld-name">${label}</div>
        <div class="bld-info"><span class="bld-cost">ğŸ¥ ${fmt(cost)}</span>${cnt>0?` Â· ${fmt(cpsC)}/s`:` Â· ${b.desc}`}</div>
      </div>
      <div class="bld-cnt ${cnt>0?'hi':''}">${cnt||''}</div>`;
    if (!locked) div.addEventListener('click', () => buyBuilding(b.id));
    list.appendChild(div);
  });
}

// Fast building refresh (only costs and affordability)
function renderBuildingsFast() {
  document.querySelectorAll('#bld-list .bld').forEach((div, i) => {
    const b = BUILDINGS[i]; if (!b) return;
    const cnt = S.buildings[b.id] || 0;
    const cost = Math.floor(b.baseCost * Math.pow(1.15, cnt));
    const afford = S.score >= cost;
    div.classList.toggle('bld-afford', afford && !div.classList.contains('bld-locked'));
    const cntEl = div.querySelector('.bld-cnt');
    if (cntEl) { cntEl.textContent = cnt||''; cntEl.className = 'bld-cnt'+(cnt>0?' hi':''); }
    const costEl = div.querySelector('.bld-cost');
    if (costEl) costEl.textContent = 'ğŸ¥ '+fmt(cost);
  });
}

function renderMilestones() {
  const row = document.getElementById('ms-row');
  if (!row) return;
  row.innerHTML = MILESTONES.map(m =>
    `<div class="ms${S.milestones[m.id]?' done':''}">${m.label}</div>`
  ).join('');
}

function renderAchievements() {
  const grid = document.getElementById('ach-grid');
  if (!grid) return;
  const done = ACHIEVEMENTS.filter(a => S.achDone[a.id]).length;
  const cnt = document.getElementById('ach-count');
  if (cnt) cnt.textContent = `${done}/${ACHIEVEMENTS.length}`;
  grid.innerHTML = ACHIEVEMENTS.map(a => {
    const unlocked = !!S.achDone[a.id];
    return `<div class="ach-card ${unlocked?'unlocked':'locked-ach'}">
      <span class="ach-icon">${a.ico}</span>
      <div class="ach-title">${unlocked ? a.name : '???'}</div>
      <div class="ach-hint">${unlocked ? a.desc : 'Keep playing!'}</div>
    </div>`;
  }).join('');
}

function renderStats() {
  const grid = document.getElementById('stats-grid');
  if (!grid) return;
  const playSecs = Math.floor((Date.now() - S.sessionStart) / 1000);
  const mins = Math.floor(playSecs/60), secs = playSecs%60;
  const items = [
    {label:'Total Bombos Earned', val:fmt(S.totalEarned), sub:'All time'},
    {label:'Current Score',       val:fmt(S.score),       sub:'Spendable'},
    {label:'Bombos Per Second',   val:fmt(S.cps),         sub:'Passive production'},
    {label:'Click Power',         val:fmt(getClickPower()), sub:'Base (no combo)'},
    {label:'Total Clicks',        val:S.totalClicks.toLocaleString(), sub:'This run'},
    {label:'Auto Clicks/sec',     val:S.autoClicks,       sub:'Automatic'},
    {label:'Prestige Level',      val:S.prestige,         sub:`Ã—${S.prestigeMult.toFixed(2)} multiplier`},
    {label:'Max Combo',           val:`Ã—${S.maxCombo.toFixed(1)}`, sub:'Best streak'},
    {label:'Golden Bombos',       val:S.goldensCaught,    sub:'Caught'},
    {label:'Achievements',        val:`${Object.keys(S.achDone).length}/${ACHIEVEMENTS.length}`, sub:'Unlocked'},
    {label:'Buildings Owned',     val:Object.values(S.buildings).reduce((a,b)=>a+b,0), sub:'Total'},
    {label:'Upgrades Bought',     val:S.stats.upgradesBought, sub:'This run'},
    {label:'Time This Session',   val:`${mins}m ${secs}s`, sub:'Keep going!'},
    {label:'Buildings Purchased', val:S.stats.totalBuildingsBought, sub:'Total bought'},
  ];
  grid.innerHTML = items.map(x =>
    `<div class="stat-card"><div class="stat-card-label">${x.label}</div>
    <div class="stat-card-val">${x.val}</div>
    <div class="stat-card-sub">${x.sub}</div></div>`
  ).join('');
}

function renderShop() {
  const list = document.getElementById('shop-list');
  if (!list) return;
  list.innerHTML = SHOP_ITEMS.map(item => {
    const bought = S.shopBought.includes(item.id);
    const unlocked = S.totalEarned >= item.req;
    const afford = S.score >= item.cost;
    return `<div class="shop-item ${!unlocked?'si-locked':''} ${bought?'si-bought':''}" onclick="${!bought&&unlocked?`buyShopItem('${item.id}')`:''}" >
      <div class="si-ico">${item.ico}</div>
      <div class="si-body">
        <div class="si-name">${item.name}</div>
        <div class="si-desc">${item.desc}</div>
        ${!bought ? `<div class="si-cost">ğŸ¥ ${fmt(item.cost)} bombos${!unlocked?' Â· Requires '+fmt(item.req)+' total':''}</div>` : ''}
        ${bought ? '<div class="si-bought-tag">PURCHASED âœ“</div>' : ''}
      </div>
    </div>`;
  }).join('');
}

function updateUI() {
  document.getElementById('big-score').textContent = fmt(S.score);
  document.getElementById('cps-line').textContent = fmt(S.cps) + ' per second';
  document.getElementById('s-click').textContent = fmt(getClickPower());
  document.getElementById('s-cps').textContent = fmt(S.cps);
  document.getElementById('s-pres').textContent = S.prestige;
  document.getElementById('s-streak').textContent = `Ã—${S.combo.toFixed(1)}`;
  document.getElementById('hdr-score').textContent = fmt(S.totalEarned);
  document.getElementById('hdr-cps').textContent = fmt(S.cps);
  document.getElementById('hdr-streak').textContent = `Ã—${S.combo.toFixed(1)}`;
  if (S.totalEarned >= 1e6) document.getElementById('prestige-btn').style.display = 'block';
  // XP bar
  const next = MILESTONES.find(m => !S.milestones[m.id]);
  if (!next) { document.getElementById('xpbar').style.width='100%'; document.getElementById('xplabel').textContent='ALL MILESTONES DONE! ğŸ†'; }
  else {
    const prev = MILESTONES[MILESTONES.indexOf(next)-1];
    const from = prev ? prev.target : 0;
    const pct = Math.min(100,((S.totalEarned-from)/(next.target-from))*100);
    document.getElementById('xpbar').style.width = pct+'%';
    document.getElementById('xplabel').textContent = `Next: ${next.label} bombos`;
  }
  // Update stats page if open
  if (currentTab === 'stats') renderStats();
  if (currentTab === 'shop') renderShop();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentTab = 'game';
function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
  document.querySelectorAll('.tab-page').forEach(p => p.classList.toggle('active-page', p.id === 'page-'+tab));
  document.getElementById('left-panel').style.visibility = tab === 'game' ? 'visible' : 'hidden';
  document.getElementById('right-panel').style.visibility = tab === 'game' ? 'visible' : 'hidden';
  if (tab === 'achievements') renderAchievements();
  if (tab === 'leaderboard') renderLeaderboard();
  if (tab === 'stats') renderStats();
  if (tab === 'shop') renderShop();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let notifT;
function notify(msg) {
  const el = document.getElementById('notif');
  el.textContent = msg; el.classList.add('show');
  clearTimeout(notifT); notifT = setTimeout(() => el.classList.remove('show'), 3000);
}
let eventT;
function showEvent(msg) {
  const el = document.getElementById('event-banner');
  el.textContent = msg; el.classList.add('show');
  clearTimeout(eventT); eventT = setTimeout(() => el.classList.remove('show'), 5000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARTICLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const cvs = document.getElementById('fx');
const ctx = cvs.getContext('2d');
function resizeCvs(){ cvs.width=window.innerWidth; cvs.height=window.innerHeight; }
resizeCvs(); window.addEventListener('resize', resizeCvs);
const parts = [];
function spawnParticles(x, y, n=10, col=null) {
  const cols=['#58cc02','#ffc800','#1cb0f6','#ff4b4b','#a8ff00','#ff9600'];
  for(let i=0;i<n;i++) parts.push({
    x,y,vx:(Math.random()-.5)*9,vy:(Math.random()-.5)*9-2,
    life:1,decay:0.025+Math.random()*0.04,
    r:2+Math.random()*5,color:col||cols[Math.floor(Math.random()*cols.length)]
  });
}
(function loop(){
  ctx.clearRect(0,0,cvs.width,cvs.height);
  for(let i=parts.length-1;i>=0;i--){
    const p=parts[i];p.x+=p.vx;p.y+=p.vy;p.vy+=0.28;p.life-=p.decay;
    if(p.life<=0){parts.splice(i,1);continue;}
    ctx.globalAlpha=p.life;ctx.fillStyle=p.color;
    ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();
  }
  ctx.globalAlpha=1;requestAnimationFrame(loop);
})();

function spawnFloat(x,y,text,color='#ffc800',big=false){
  const el=document.createElement('div');
  el.className='ftxt'+(big?' crit':'');
  el.style.color=color;
  el.style.left=(x-25+(Math.random()*40-20))+'px';
  el.style.top=(y-35)+'px';el.textContent=text;
  document.body.appendChild(el);setTimeout(()=>el.remove(),1100);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAll() {
  renderUpgrades(); renderBuildings(); renderMilestones();
  renderAchievements(); renderShop();
}

loadGame();
recalcCps();
renderAll(); updateUI();
setTimeout(() => notify('ğŸ¥ Click Mi Bombo! Buy buildings! Catch Golden Bombos! Watch out for Duo! ğŸ¦‰'), 800);

// Keyboard shortcut: Space to click
document.addEventListener('keydown', e => {
  if (e.code === 'Space' && e.target.tagName !== 'INPUT') {
    e.preventDefault();
    mbtn.click();
  }
});
</script>
</body>
</html>